<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DS1 Mock Shop</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1200px; margin: 0 auto; padding: 2rem; background: #f9f9f9; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        h1 { color: #333; margin: 0; }
        .nav-link { text-decoration: none; color: #007bff; font-weight: bold; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        
        .card-img { width: 100%; height: 250px; background: #eee; display: flex; align-items: center; justify-content: center; color: #aaa; font-size: 3rem; }
        .card-img img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-body { padding: 1.5rem; }
        .card-title { font-size: 1.25rem; margin: 0 0 0.5rem 0; color: #222; }
        .card-price { font-size: 1.5rem; color: #28a745; font-weight: bold; margin-bottom: 1rem; }
        .card-desc { color: #666; font-size: 0.9rem; margin-bottom: 1.5rem; line-height: 1.5; }
        
        .btn { display: block; width: 100%; padding: 0.75rem; border: none; border-radius: 6px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; text-align: center; text-decoration: none; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        
        .toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 1rem 2rem; border-radius: 8px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>
    <header>
        <h1>üõçÔ∏è DS1 Mock Shop</h1>
        <a href="admin.html" class="nav-link">‚öôÔ∏è Control Panel</a>
    </header>

    <div id="productGrid" class="grid">
        <!-- Products will be injected here -->
        <p>Loading products...</p>
    </div>

    <div id="toast" class="toast">Order placed successfully!</div>

    <script>
        async function loadProducts() {
            const grid = document.getElementById('productGrid');
            try {
                const res = await fetch('/api/products');
                const products = await res.json();

                if (products.length === 0) {
                    grid.innerHTML = '<p>No products available. Run a simulation in the Control Panel first.</p>';
                    return;
                }

                grid.innerHTML = products.map(p => {
                    // Use a placeholder if no image or if image is a placeholder URL
                    const imgUrl = (p.images && p.images.length > 0) ? p.images[0] : null;
                    const imgTag = imgUrl 
                        ? `<img src="${imgUrl}" alt="${p.name}">` 
                        : `<span>üì¶</span>`;
                    
                    // Mock price if not present (simulation might not set it on the product object directly)
                    const price = p.price || 49.99; 

                    return `
                    <div class="card">
                        <div class="card-img">${imgTag}</div>
                        <div class="card-body">
                            <h3 class="card-title">${p.name}</h3>
                            <div class="card-price">$${price}</div>
                            <p class="card-desc">
                                Potential: <strong>${p.potential}</strong><br>
                                Margin: ${p.margin}
                            </p>
                            <button class="btn btn-primary" onclick="buyProduct('${p.name}', ${price})">Buy Now</button>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (e) {
                grid.innerHTML = `<p style="color:red">Error loading products: ${e.message}</p>`;
            }
        }

        async function buyProduct(name, price) {
            try {
                const res = await fetch('/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product: name, amount: price })
                });
                
                if (res.ok) {
                    showToast(`Order placed for ${name}!`);
                } else {
                    showToast('Failed to place order.', true);
                }
            } catch (e) {
                showToast('Error connecting to server.', true);
            }
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.background = isError ? '#dc3545' : '#28a745';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Load on start
        loadProducts();
    </script>
</body>
</html>
